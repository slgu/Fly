func process(msg) {
    filename = "p1";
    print(msg);
    res = exec(msg, filename);
    print(res);
    print(res);
    print(res);
    print(res);
    print(res);
    print(res);
    return res;
}

func send_back(con, msg) {
    print(msg);
    con.send(msg);
}

func handle_req(con) {
    while(true) {
        msg = con.recv();
        if (!con.is_alive()) {
            break;
        }
        s = fly process(msg);
        register s send_back(con);
    }
}

func main() {
    a = @server;
    a.listen(5567);
    while(true) {
        con = a.accept();
        fly handle_req(con);
    }
    return 0;
}
