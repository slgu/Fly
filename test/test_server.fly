func process(msg) {
    return "Done: " + msg;
}

func send_back(con, msg) {
    con.send(msg);
}

func handle_req(con) {
    while(con.is_alive()) {
        msg = con.recv();
	print(msg);
        s = fly process(msg);
        register s send_back(con);
    }
}

func main() {
    a = @server;
    a.listen(5566);
    while(true) {
        con = a.accept();
        fly handle_req(con);
    }
    return 0;
}
